from __future__ import annotations

from typing import Dict


_TRANSLATIONS: Dict[str, Dict[str, str]] = {
    "RU": {
        "app_name": "Binity",
        "recycle_bin": "Корзина",
        "tooltip_template": "Корзина: {size}",
        "open_bin": "Открыть корзину",
        "clear_bin": "Очистить корзину",
        "settings": "Настройки",
        "confirm_clear": "Запрашивать подтверждение",
        "double_click_action": "Двойной клик",
        "open_bin_action": "Открыть корзину",
        "clear_bin_action": "Очистить корзину",
        "language": "Язык",
        "language_ru": "Русский",
        "language_en": "Английский",
        "autostart": "Запускать с Windows",
        "sound_after_clear": "Звук после очистки",
        "sound_off": "Без звука",
        "sound_windows": "Системный звук Windows",
        "sound_paper": "Сминание бумаги",
        "sound_trash": "Бросок в корзину",
        "secure_delete": "Безвозвратное удаление",
        "secure_delete_off": "Обычная очистка (быстро)",
        "secure_delete_zero": "Secure Delete: 1-pass нулями",
        "secure_delete_random": "Secure Delete: 1-pass случайными данными",
        "secure_delete_load_note": "Повышает нагрузку на диск и замедляет очистку",
        "secure_delete_info_title": "Безвозвратное удаление",
        "secure_delete_info_message": "Режим повышает нагрузку на диск. Для SSD/NVMe абсолютная гарантия стирания не обеспечивается из-за wear leveling.",
        "secure_clear_started": "Запущена безопасная очистка. Возможна повышенная нагрузка на диск.",
        "secure_clear_success_message": "Безопасная очистка завершена: перезаписано {files} файлов ({size}).",
        "secure_clear_partial_message": "Часть файлов не удалось перезаписать ({failed}). Остальные элементы удалены стандартно.",
        "overflow_notify": "Уведомлять о переполнении",
        "theme_sync": "Синхронизировать тему",
        "windows_submenu": "Windows",
        "auto_check_updates": "Автопроверка обновлений",
        "check_updates": "Проверить обновления",
        "update_now": "Обновить до {version}",
        "update_available_title": "Доступно обновление",
        "update_available_message": "Найдена новая версия {version}.",
        "update_not_found": "Установлена актуальная версия.",
        "update_dialog_title": "Обновление Binity",
        "update_dialog_message": "Доступна новая версия: {version}",
        "update_dialog_hint": "Выберите действие для обновления.",
        "update_install": "Обновить",
        "update_skip": "Пропустить версию",
        "update_later": "Позже",
        "release_notes": "Описание релиза",
        "update_checking": "Проверка обновлений...",
        "update_downloading": "Скачивание обновления...",
        "update_downloading_progress": "Скачивание обновления... {percent}%",
        "update_applying": "Обновление скачано. Применяю обновление...",
        "update_installed": "Binity успешно обновлён.",
        "update_running_from_fallback": "Обновление запущено из временной папки: {path}\nОригинальный файл не удалось заменить: {final}",
        "error_update_check": "Не удалось проверить обновления.",
        "error_update_download": "Не удалось скачать обновление.",
        "error_update_apply": "Не удалось применить обновление.",
        "about": "О программе",
        "exit": "Выход",
        "confirm_dialog_title": "Подтверждение очистки корзины",
        "confirm_dialog_message": "Удалить все элементы из корзины без возможности восстановления?",
        "confirm_dialog_message_secure_zero": "Выполнить безопасную очистку корзины (1-pass нулями)?\n\nЭто замедлит операцию и увеличит нагрузку на диск.",
        "confirm_dialog_message_secure_random": "Выполнить безопасную очистку корзины (1-pass случайными данными)?\n\nЭто самая тяжелая нагрузка на диск среди режимов очистки.",
        "confirm": "Очистить",
        "cancel": "Отмена",
        "about_title": "О программе",
        "version": "Версия",
        "author": "Разработчик",
        "website": "Открыть GitHub",
        "close": "Закрыть",
        "already_running": "Binity уже запущен. Проверьте иконку в системном трее.",
        "error_title": "Ошибка",
        "error_open_failed": "Не удалось открыть корзину.",
        "error_empty_failed": "Не удалось очистить корзину.",
        "autostart_enabled": "Автозапуск включен",
        "autostart_disabled": "Автозапуск отключен",
        "clear_success_message": "Корзина успешно очищена.",
        "overflow_title": "Внимание: корзина переполнена",
        "overflow_message": "Корзина переполнена ({size}).",
    },
    "EN": {
        "app_name": "Binity",
        "recycle_bin": "Recycle Bin",
        "tooltip_template": "Recycle Bin: {size}",
        "open_bin": "Open Recycle Bin",
        "clear_bin": "Empty Recycle Bin",
        "settings": "Settings",
        "confirm_clear": "Ask for confirmation",
        "double_click_action": "Double click",
        "open_bin_action": "Open Recycle Bin",
        "clear_bin_action": "Empty Recycle Bin",
        "language": "Language",
        "language_ru": "Russian",
        "language_en": "English",
        "autostart": "Run with Windows",
        "sound_after_clear": "Sound after empty",
        "sound_off": "No sound",
        "sound_windows": "Windows system sound",
        "sound_paper": "Paper crumple",
        "sound_trash": "Throw in trash",
        "secure_delete": "Secure delete",
        "secure_delete_off": "Normal empty (fast)",
        "secure_delete_zero": "Secure Delete: 1-pass zeros",
        "secure_delete_random": "Secure Delete: 1-pass random data",
        "secure_delete_load_note": "Increases disk load and slows cleanup",
        "secure_delete_info_title": "Secure Delete",
        "secure_delete_info_message": "This mode increases disk load. On SSD/NVMe absolute wipe guarantees are not possible due to wear leveling.",
        "secure_clear_started": "Secure cleanup started. Disk activity may temporarily increase.",
        "secure_clear_success_message": "Secure cleanup finished: overwritten {files} files ({size}).",
        "secure_clear_partial_message": "Some files could not be overwritten ({failed}). Remaining items were removed normally.",
        "overflow_notify": "Notify when overloaded",
        "theme_sync": "Sync theme",
        "windows_submenu": "Windows",
        "auto_check_updates": "Auto-check updates",
        "check_updates": "Check for updates",
        "update_now": "Update to {version}",
        "update_available_title": "Update available",
        "update_available_message": "New version {version} is available.",
        "update_not_found": "You already have the latest version.",
        "update_dialog_title": "Binity Update",
        "update_dialog_message": "New version available: {version}",
        "update_dialog_hint": "Choose what to do with this update.",
        "update_install": "Update",
        "update_skip": "Skip this version",
        "update_later": "Later",
        "release_notes": "Release notes",
        "update_checking": "Checking for updates...",
        "update_downloading": "Downloading update...",
        "update_downloading_progress": "Downloading update... {percent}%",
        "update_applying": "Update downloaded. Applying update...",
        "update_installed": "Binity was updated successfully.",
        "update_running_from_fallback": "Update is running from temporary location: {path}\nCould not replace original executable: {final}",
        "error_update_check": "Failed to check for updates.",
        "error_update_download": "Failed to download update.",
        "error_update_apply": "Failed to apply update.",
        "about": "About",
        "exit": "Exit",
        "confirm_dialog_title": "Confirm Empty Recycle Bin",
        "confirm_dialog_message": "Delete all items from Recycle Bin permanently?",
        "confirm_dialog_message_secure_zero": "Run secure recycle-bin cleanup (1-pass zeros)?\n\nThis is slower and increases disk load.",
        "confirm_dialog_message_secure_random": "Run secure recycle-bin cleanup (1-pass random data)?\n\nThis is the heaviest disk load mode.",
        "confirm": "Empty",
        "cancel": "Cancel",
        "about_title": "About",
        "version": "Version",
        "author": "Author",
        "website": "Open GitHub",
        "close": "Close",
        "already_running": "Binity is already running. Check the tray icon.",
        "error_title": "Error",
        "error_open_failed": "Failed to open Recycle Bin.",
        "error_empty_failed": "Failed to empty Recycle Bin.",
        "autostart_enabled": "Autostart enabled",
        "autostart_disabled": "Autostart disabled",
        "clear_success_message": "Recycle Bin emptied successfully.",
        "overflow_title": "Warning: recycle bin overloaded",
        "overflow_message": "Recycle Bin is overloaded ({size}).",
    },
}


class I18n:
    def __init__(self, language: str = "RU") -> None:
        self._language = "RU"
        self.set_language(language)

    @property
    def language(self) -> str:
        return self._language

    def set_language(self, language: str) -> str:
        candidate = str(language or "RU").upper()
        if candidate not in _TRANSLATIONS:
            candidate = "RU"
        self._language = candidate
        return self._language

    def tr(self, key: str) -> str:
        return _TRANSLATIONS[self._language].get(key, key)
